<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Uchiha AI Robot</title>
    <style>
        body { background: #050505; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        
        /* Khung mặt Robot ảnh 2 */
        #robot-face {
            width: 450px; height: 280px;
            background: #1a1a1a;
            border: 6px solid #333;
            border-radius: 50px;
            display: flex; align-items: center; justify-content: space-around;
            box-shadow: inset 0 0 50px #000, 0 0 30px rgba(0,0,0,0.5);
            position: relative;
        }

        /* Mắt hình khối bo góc (Ảnh 2) */
        .eye-block {
            width: 100px; height: 100px;
            background: #00f2ff;
            border-radius: 25px;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 0 35px #00f2ff;
            display: flex; align-items: center; justify-content: center;
            overflow: hidden;
        }

        /* Style cho Sharingan trong mắt */
        .sharingan-svg { width: 100%; height: 100%; display: none; }
        
        /* Cảm xúc */
        .scared { transform: scale(0.6); animation: shake 0.1s infinite; background: #fff !important; box-shadow: 0 0 40px #fff !important; }
        .heart-eye { background: #ff2d55 !important; clip-path: path('M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'); transform: scale(1.5); }
        .happy { height: 40px !important; border-radius: 50px 50px 10px 10px; }
        .angry { transform: rotate(15deg); clip-path: polygon(0% 20%, 100% 0%, 100% 100%, 0% 100%); }

        @keyframes shake { 0% { transform: translate(2px, 2px); } 50% { transform: translate(-2px, -2px); } 100% { transform: translate(2px, -2px); } }
        
        video { position: fixed; bottom: 10px; left: 10px; width: 150px; border-radius: 10px; border: 2px solid #00f2ff; }
        #subtitle { margin-top: 20px; font-size: 1.2rem; color: #00f2ff; text-transform: uppercase; letter-spacing: 2px; height: 30px; }
    </style>
</head>
<body>

    <div id="robot-face">
        <div id="left-eye" class="eye-block">
            <svg class="sharingan-svg" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="45" fill="red" stroke="black" stroke-width="2"/>
                <circle cx="50" cy="50" r="8" fill="black"/>
                <circle cx="50" cy="50" r="25" fill="none" stroke="black" stroke-width="1" stroke-dasharray="2"/>
                <path d="M50 25 Q55 25 55 20 A5 5 0 1 0 45 20 Q45 25 50 25" fill="black" transform="rotate(0 50 50)"/>
                <path d="M50 25 Q55 25 55 20 A5 5 0 1 0 45 20 Q45 25 50 25" fill="black" transform="rotate(120 50 50)"/>
                <path d="M50 25 Q55 25 55 20 A5 5 0 1 0 45 20 Q45 25 50 25" fill="black" transform="rotate(240 50 50)"/>
            </svg>
        </div>
        <div id="right-eye" class="eye-block">
            <svg class="sharingan-svg" viewBox="0 0 100 100">
                <circle cx="50" cy="50" r="45" fill="red" stroke="black" stroke-width="2"/>
                <circle cx="50" cy="50" r="8" fill="black"/>
                <path d="M50 25 Q55 25 55 20 A5 5 0 1 0 45 20 Q45 25 50 25" fill="black"/>
                <path d="M50 25 Q55 25 55 20 A5 5 0 1 0 45 20 Q45 25 50 25" fill="black" transform="rotate(120 50 50)"/>
                <path d="M50 25 Q55 25 55 20 A5 5 0 1 0 45 20 Q45 25 50 25" fill="black" transform="rotate(240 50 50)"/>
            </svg>
        </div>
    </div>

    <div id="subtitle">Hệ thống đang khởi động...</div>
    <video id="video" autoplay playsinline muted></video>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        const leftEye = document.getElementById('left-eye');
        const rightEye = document.getElementById('right-eye');
        const svgs = document.querySelectorAll('.sharingan-svg');
        const subtitle = document.getElementById('subtitle');

        // 1. CHUỖI KHỞI ĐỘNG SHARINGAN 4 CẶP x 4S
        async function startup() {
            for(let i=1; i<=4; i++) {
                subtitle.innerText = `KÍCH HOẠT SHARINGAN CẤP ${i}`;
                leftEye.style.background = "transparent";
                rightEye.style.background = "transparent";
                svgs.forEach(s => s.style.display = 'block');
                // Thay đổi độ xoay hoặc số lượng phẩy tùy theo cấp độ i (giả lập)
                svgs.forEach(s => s.style.transform = `rotate(${i * 90}deg)`);
                await new Promise(r => setTimeout(r, 4000));
            }
            svgs.forEach(s => s.style.display = 'none');
            startNormalMode();
        }

        // 2. CHẾ ĐỘ CẢM XÚC 13S
        function startNormalMode() {
            const emotions = ['normal', 'happy', 'angry', 'surprised', 'normal'];
            let current = 0;
            
            setInterval(() => {
                setEmotion(emotions[current]);
                current = (current + 1) % emotions.length;
            }, 13000);
            
            initCamera();
            initVoice();
            speak("Chào chủ nhân, hệ thống đã sẵn sàng.");
        }

        function setEmotion(type) {
            leftEye.className = 'eye-block';
            rightEye.className = 'eye-block';
            subtitle.innerText = type.toUpperCase();

            if(type === 'scared') {
                leftEye.classList.add('scared');
                rightEye.classList.add('scared');
                speak("Làm ơn bỏ tay xuống, tôi sợ!");
            } else if(type === 'heart') {
                leftEye.classList.add('heart-eye');
                rightEye.classList.add('heart-eye');
                speak("Tôi yêu bạn, Béo ơi");
            } else if(type !== 'normal') {
                leftEye.classList.add(type);
                rightEye.classList.add(type);
            }
        }

        // 3. GIỌNG NÓI PHẢN HỒI (AI SPEAK)
        function speak(text) {
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'vi-VN';
            window.speechSynthesis.speak(msg);
        }

        // 4. NGHE LỆNH "BÉO"
        function initVoice() {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.lang = 'vi-VN';
            recognition.continuous = true;
            
            recognition.onresult = (event) => {
                const last = event.results.length - 1;
                const command = event.results[last][0].transcript.toLowerCase();
                console.log("Nghe thấy:", command);
                if(command.includes("béo")) {
                    setEmotion('heart');
                    setTimeout(() => setEmotion('normal'), 13000);
                }
            };
            
            recognition.onerror = () => recognition.start(); // Tự khởi động lại nếu lỗi
            recognition.onend = () => recognition.start();   // Luôn luôn lắng nghe
            recognition.start();
        }

        // 5. THỊ GIÁC (NẮM ĐẤM)
        function initCamera() {
            const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
            hands.setOptions({ maxNumHands: 1, minDetectionConfidence: 0.7 });
            hands.onResults(results => {
                if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                    const lm = results.multiHandLandmarks[0];
                    // Kiểm tra nắm đấm (Đầu ngón tay 8, 12, 16, 20 thấp hơn khớp)
                    if(lm[8].y > lm[6].y && lm[12].y > lm[10].y) {
                        setEmotion('scared');
                    }
                }
            });

            const camera = new Camera(document.getElementById('video'), {
                onFrame: async () => { await hands.send({image: document.getElementById('video')}); },
                width: 640, height: 480
            });
            camera.start();
        }

        startup();
    </script>
</body>
</html>
