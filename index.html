<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Robot AI Interface</title>
    <style>
        body { background: #000; color: white; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; overflow: hidden; font-family: sans-serif; }
        #display-container { width: 320px; height: 200px; border: 4px solid #333; border-radius: 20px; display: flex; align-items: center; justify-content: center; background: #000; position: relative; }
        .eye { width: 80px; height: 80px; background: #00FFFF; margin: 20px; border-radius: 15px; transition: all 0.3s; box-shadow: 0 0 20px #00FFFF; }
        
        /* Hiệu ứng Sharingan */
        .sharingan { width: 100px; height: 100px; border-radius: 50%; background: red; border: 3px solid black; position: relative; }
        .sharingan::after { content: '9'; font-size: 20px; position: absolute; top: 20%; left: 20%; color: black; }
        
        /* Cảm xúc */
        .fear { width: 40px; height: 40px; transform: scale(0.8); animation: shake 0.1s infinite; }
        .heart { background: #ff4d4d; clip-path: path('M12 21.593c-5.63-5.539-11-10.297-11-14.402 0-3.791 3.068-5.191 5.281-5.191 1.312 0 4.151.501 5.719 4.457 1.59-3.968 4.464-4.447 5.726-4.447 2.54 0 5.274 1.621 5.274 5.181 0 4.069-5.136 8.625-11 14.402m5.726-20.583c-2.203 0-4.446 1.042-5.726 3.146-1.28-2.104-3.523-3.146-5.726-3.146-4.274 0-7.274 3.394-7.274 7.191 0 5.147 5.313 10.125 11 16.01 5.687-5.885 11-10.863 11-16.01 0-3.968-3.265-7.191-7.274-7.191'); transform: scale(3); }
        
        @keyframes shake { 0% { transform: translate(1px, 1px); } 50% { transform: translate(-1px, -1px); } 100% { transform: translate(1px, -1px); } }
        video { position: absolute; bottom: 10px; right: 10px; width: 120px; opacity: 0.3; border-radius: 10px; }
        #status { margin-top: 20px; color: #555; font-size: 12px; }
    </style>
</head>
<body>

    <div id="display-container">
        <div id="left-eye" class="eye"></div>
        <div id="right-eye" class="eye"></div>
    </div>
    
    <video id="video" autoplay playsinline></video>
    <div id="status">Đang khởi động hệ thống Sharingan...</div>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>

    <script>
        const leftEye = document.getElementById('left-eye');
        const rightEye = document.getElementById('right-eye');
        const statusText = document.getElementById('status');
        const videoElement = document.getElementById('video');

        // 1. CHUỖI KHỞI ĐỘNG SHARINGAN (4 cặp x 4 giây)
        const sharinganColors = ['#ff0000', '#cc0000', '#990000', '#660000'];
        let step = 0;

        function startup() {
            if (step < 4) {
                statusText.innerText = `Kích hoạt Sharingan cấp độ ${step + 1}...`;
                leftEye.style.background = 'red';
                rightEye.style.background = 'red';
                leftEye.style.borderRadius = '50%';
                rightEye.style.borderRadius = '50%';
                step++;
                setTimeout(startup, 4000);
            } else {
                startNormalMode();
            }
        }

        // 2. CHẾ ĐỘ HOẠT ĐỘNG BÌNH THƯỜNG
        function startNormalMode() {
            statusText.innerText = "Robot đang lắng nghe và quan sát...";
            setEmotion('normal');
            initCamera();
            initVoice();
            
            // Chuyển đổi 5 cảm xúc mỗi 13 giây
            const emotions = ['normal', 'happy', 'sad', 'surprised', 'angry'];
            let eIdx = 0;
            setInterval(() => {
                setEmotion(emotions[eIdx]);
                eIdx = (eIdx + 1) % emotions.length;
            }, 13000);
        }

        function setEmotion(type) {
            leftEye.className = 'eye';
            rightEye.className = 'eye';
            leftEye.style.borderRadius = '15px';
            rightEye.style.borderRadius = '15px';
            leftEye.style.background = '#00FFFF';
            rightEye.style.background = '#00FFFF';

            if (type === 'scared') {
                leftEye.classList.add('fear');
                rightEye.classList.add('fear');
            } else if (type === 'heart') {
                leftEye.classList.add('heart');
                rightEye.classList.add('heart');
                leftEye.style.background = '#ff4d4d';
                rightEye.style.background = '#ff4d4d';
            }
        }

        // 3. NHẬN DIỆN CỬ CHỈ (NẮM ĐẤM)
        function initCamera() {
            const hands = new Hands({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`});
            hands.setOptions({ maxNumHands: 1, modelComplexity: 1, minDetectionConfidence: 0.5 });
            
            hands.onResults((results) => {
                if (results.multiHandLandmarks.length > 0) {
                    const landmarks = results.multiHandLandmarks[0];
                    // Logic nắm đấm: ngón trỏ (8) thấp hơn khớp (6)
                    if (landmarks[8].y > landmarks[6].y) {
                        setEmotion('scared');
                        setTimeout(() => setEmotion('normal'), 2000);
                    }
                }
            });

            const camera = new Camera(videoElement, {
                onFrame: async () => { await hands.send({image: videoElement}); },
                width: 640, height: 480
            });
            camera.start();
        }

        // 4. NHẬN DIỆN GIỌNG NÓI ("BÉO")
        function initVoice() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) return;

            const recognition = new SpeechRecognition();
            recognition.continuous = true;
            recognition.lang = 'vi-VN';

            recognition.onresult = (event) => {
                const text = event.results[event.results.length - 1][0].transcript.toLowerCase();
                console.log("Nghe thấy:", text);
                if (text.includes("béo")) {
                    setEmotion('heart');
                    setTimeout(() => setEmotion('normal'), 13000);
                }
            };
            recognition.start();
        }

        // Chạy khởi động
        startup();
    </script>
</body>
</html>
